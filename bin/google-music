#!/bin/sh

app="$HOME/.local/share/applications/chrome-fahmaaghhglfmonjliepjlchgpgfmobi-Default.desktop"

function sendkeys {
    class="$(sed -rne 's/^.*--app-id=([a-zA-Z0-9]+).*/crx_\1/p' $app)"
    gm="$(xdotool search --all --classname $class)"

    [ -z "$gm" ] && exit 1

    cur="$(xdotool getactivewindow)"

    xdotool \
        windowactivate "$gm" \
        windowfocus "$gm" \
        key --window "$gm" --clearmodifiers "$@" \
        windowactivate "$cur" \
        windowfocus "$cur"
}

case "$1" in
    playpause) sendkeys space;;
    prev) sendkeys Left;;
    next) sendkeys Right;;
    '')
        gtk-launch google-music-chrome.desktop;;
    *)
        echo "unknown command '$1'" 1>&2
        exit 1;;
esac
